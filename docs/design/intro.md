# 认识微服务架构
## 什么是微服务架构
微服务的概念最早由Martin Fowler提出（又是JAVA领域发明的😅），现在可以说火遍互联网行业，写个方案不往微服务上靠靠，都不好意思拿出手。以前我一直以为微服务就是新瓶装旧酒，只不过是以前SOA概念再次包装而已，最近集中研究了一些微服务资料，发现不是这么简单。
微服务架构就是把一个大系统按业务功能分解成多个职责单一的小系统，强调业务系统要做成组件化和服务化。通过轻量级通信机制（RPC或RESTful API）使多个小系统相互协作，组合成一个大系统。通俗来说，微服务架构就像搭积木，每块积木都是一个微服务，都有自己独立的运行环境和具体业务，可独立部署。
## 常见的微服务组件及概念
- **服务注册** 服务提供方将自己调用地址注册到服务注册中心，让服务调用方能够方便地找到自己。
- **服务发现** 服务调用方从服务注册中心找到自己需要调用的服务地址。
- **负载均衡** 为了保证高性能和高可用，服务提供方一般都会以多实例节点形式部署，通过负载均衡组件来分配调用请求到合适的节点上，并且这个组件必须对调用者透明。
- **服务网关** 服务网关是服务调用的唯一入口，可以在这个组件实现权限控制、动态路由、灰度发布、A/B测试、负载限流等功能。
- **集成框架** 微服务组件都以职责单一的程序包对外提供服务，集成框架以配置的形式将所有微服务组件(特别是管理端组件)集成到统一的界面框架下，让用户能够在统一的界面中使用系统。
- **分布式事务** 分布式事务是指事务的参与者、支持事务的服务器、资源服务器以及事务管理器分别位于不同的分布式系统的不同节点之上。负载不大的场景下，可以用数据库实现。
- **调用链** 记录完成一个业务逻辑时调用到的微服务，并将这种串行或并行的调用关系展示出来。在系统出错时，可以方便地找到出错点。
- **支撑平台** 微服务系统会变得更加碎片化，系统部署、运维和监控都比单体系统复杂，需要一些自动化工具来简化工作。

## 微服务架构 vs. 单体架构

从上面描述可看出，微服务架构可以看成由多个单体架构开发的模块组成，为了让多个模块能互相协作，还需增加很多支撑服务及模块。相对于单体架构，微服务架构学习曲线陡，开发、部署困难，进而造成项目成本更高。虽然有上述缺点，但微服务架构天生是高内聚，低耦合系统，所以更方便控制系统风险，便于对系统进行二次开发和优化，能更快地响应需求变更。综上所述，微服务架构更适用于业务复杂度较高，需要长期演进维护的场景。

||微服务架构|单体架构|
|:--:|:--:|:--:|
|学习曲线|✗|✓|
|简单项目开发效率|✗|✓|
|复杂项目开发效率|✓|✗|
|简单项目运行效率|✗|✓|
|复杂项目运行效率|✓|✗|
|系统维护性|✓|✗|
|系统扩展性|✓|✗|
|需求变更响应速度|✓|✗|
|运维友好|✗|✓|
|项目风险|✓|✗|

## 微服务架构 vs. SOA
其实从我的认知来看，SOA和微服务目标是一致的——为了解决单体系统复杂，难以理解，难以维护的现状，提出面向服务解耦合，统一接口等提出的架构原则。当年SOA为了抢占传统J2EE市场，包含了一个重要模式：ESB。出发点很好，希望用ESB模式来整合大量单体应用，保护企业前期投入成本。然而现实很残酷，无数项目实施ESB，却失败了，因此也给SOA蒙上阴影。
微服务架构不再强调ESB，进而考虑围绕着业务领域组件来创建应用，每个应用可以独立开发，部署和管理。虽然不再提ESB，但基础服务本身，比如服务注册、路由、安全、监控等依然需要一个统一的服务管理平台来实现。当然因为微服务应用之间尽可能使用HTTP API通信，相对ESB更轻量级。